<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/pharmacy/static/css/tailwind.css">
    <link rel="stylesheet" href="/pharmacy/static/css/style.css">
    <title>Medicine Page</title>
</head>
<body class="bg-gray-100 min-h-screen flex flex-col">
    <section class="mx-auto fixed z-50 flex flex-col items-end">
      <!-- navbar -->
        <nav class="flex justify-between bg-gray-900 text-white w-screen">
          <div class="px-5 xl:px-12 py-6 flex w-full items-center">
            <a class="text-3xl font-bold font-heading" href="/client/client_page">
              <!-- <img class="h-9" src="logo.png" alt="logo"> -->
              PHARMA
            </a>
            <!-- Nav Links -->
            <ul class="hidden md:flex px-4 mx-auto font-semibold font-heading space-x-12">
              <li><a class="hover:text-gray-200" href="/client/client_page">Home</a></li>
              <li><a class="hover:text-gray-200" href="/client/client_page">Pharmacy</a></li>
              <li><a class="hover:text-gray-200" href="/client/client_page">Medicine</a></li>
              <li><a class="hover:text-gray-200" href="/client/client_page">Reservation</a></li>
            </ul>
            <!-- Header Icons -->
            <div class="hidden xl:flex items-center space-x-5 items-center">
              <button type="button" class="flex items-center hover:text-gray-200" onclick="toggleReservationDropdown()">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" />
                  </svg>
                <span class="flex absolute -mt-5 ml-4">
                  <span class="animate-ping absolute inline-flex h-3 w-3 rounded-full bg-pink-400 opacity-75"></span>
                    <span class="relative inline-flex rounded-full h-3 w-3 bg-pink-500">
                    </span>
                  </span>
              </button>

             <button type="button" class="flex items-center hover:text-gray-200" onclick="toggleDropdown()"
                     id="user-menu-button" aria-expanded="false" data-dropdown-toggle="user-dropdown" data-dropdown-placement="bottom">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 hover:text-gray-200" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5.121 17.804A13.937 13.937 0 0112 16c2.5 0 4.847.655 6.879 1.804M15 10a3 3 0 11-6 0 3 3 0 016 0zm6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                  </svg>
             </button>
            </div>
          </div>
          <!-- Responsive navbar -->
          <a class="xl:hidden flex mr-6 items-center" href="#">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 hover:text-gray-200" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" />
            </svg>
            <span class="flex absolute -mt-5 ml-4">
              <span class="animate-ping absolute inline-flex h-3 w-3 rounded-full bg-pink-400 opacity-75"></span>
              <span class="relative inline-flex rounded-full h-3 w-3 bg-pink-500">
              </span>
            </span>
          </a>
          <a class="navbar-burger self-center mr-12 xl:hidden" href="#">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 hover:text-gray-200" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
              </svg>
          </a>
        </nav>
        <!-- dropdown element -->
        <div class="absolute z-50 mt-24">
               <div id="navbar_dropdown"
                     class="hidden mr-5 text-base list-none bg-white divide-y divide-gray-100 rounded-lg shadow dark:bg-gray-700 dark:divide-gray-600 w-auto">
                    <div class="px-4 py-3">
                        <span class="block text-sm text-gray-900 dark:text-white">{{ client.name }}</span>
                        <span class="block text-sm text-gray-500 truncate dark:text-gray-400">{{ client.email }}</span>
                    </div>
                    <ul class="py-2" aria-labelledby="user-menu-button">
                        <li>
                            <a href="/client/login" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 dark:hover:bg-gray-600 dark:text-gray-200 dark:hover:text-white">Sign out</a>
                        </li>
                    </ul>
               </div>
               <div id="navbar_reservation_dropdown"
                     class="hidden mr-5 text-base list-none bg-white divide-y divide-gray-100 rounded-lg shadow dark:bg-gray-700 dark:divide-gray-600 w-auto">
                    <div  class="relative overflow-x-auto shadow-md sm:rounded-lg">
                        <table class="w-full text-sm text-left rtl:text-right text-gray-500 dark:text-gray-400">
                            <thead class="text-xs text-gray-700 uppercase bg-gray-50 dark:bg-gray-700 dark:text-gray-400">
                                <tr>
                                    <th scope="col" class="px-6 py-3">
                                        Medicine
                                    </th>
                                    <th scope="col" class="px-6 py-3">
                                        Amount
                                    </th>
                                    <th scope="col" class="px-6 py-3">
                                        Price
                                    </th>
                                    <th scope="col" class="px-6 py-3">
                                        <span class="sr-only">Delete</span>
                                    </th>
                                </tr>
                            </thead>
                            <tbody id="reservation-list">

                            </tbody>
                        </table>
                    </div>

               </div>
           </div>
    </section>

    <main class="flex flex-grow items-center justify-center mt-24 p-4">
        <div class="bg-gray-100">
            <section class="relative rounded-lg overflow-hidden shadow-lg max-w-5xl mx-auto lg:max-w-6xl">
                <div class="w-full mx-auto px-4 sm:px-6 lg:px-0">
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-16 mx-auto max-md:px-2">
                        <div class="img flex items-center content-center">
                            <div class="img-box max-h-96 max-lg:mx-auto flex items-center content-center">
                                <img id="medicine-image" alt="Medicine Image"
                                    class="max-lg:mx-auto h-full rounded-2xl object-cover">
                            </div>
                        </div>
                        <div class="data w-full lg:pr-8 pr-0 pb-2 xl:justify-start justify-center flex items-center max-lg:pb-5 xl:my-2 lg:my-5 my-0">
                            <div class="data w-full max-w-xl">
                                <h2 id="medicine-name" class="font-manrope font-bold text-3xl leading-10 text-gray-900 mb-1 capitalize"></h2>
                                <div class="flex flex-col sm:flex-row sm:items-center mb-1">
                                    <h6 class="font-manrope font-semibold text-2xl leading-9 text-gray-900">$</h6>
                                    <h6 id="medicine-price" class="font-manrope font-semibold text-2xl leading-9 text-gray-900 pr-5 sm:border-r border-gray-200 mr-1"></h6>
                                    <h6 id="medicine-amount" class="ml-4 font-manrope font-semibold text-2xl leading-9 text-gray-900"></h6>
                                </div>
                                <p id="medicine-presentation" class="text-gray-500 text-base font-normal mb-2"><a href="#"
                                        class="text-indigo-600">More....</a>
                                </p>
                                <ul class="flex flex-wrap gap-4 mb-4">
                                    <li class="flex items-center gap-3">
                                        <svg width="26" height="26" viewBox="0 0 26 26" fill="none"
                                            xmlns="http://www.w3.org/2000/svg">
                                            <rect width="26" height="26" rx="13" fill="#4F46E5" />
                                            <path
                                                d="M7.66669 12.629L10.4289 15.3913C10.8734 15.8357 11.0956 16.0579 11.3718 16.0579C11.6479 16.0579 11.8701 15.8357 12.3146 15.3913L18.334 9.37183"
                                                stroke="white" stroke-width="1.6" stroke-linecap="round" />
                                        </svg>
                                        <span id="medicine-composition" class="font-normal text-base text-gray-900 "></span>
                                    </li>
                                    <li class="flex items-center gap-3">
                                        <svg width="26" height="26" viewBox="0 0 26 26" fill="none"
                                            xmlns="http://www.w3.org/2000/svg">
                                            <rect width="26" height="26" rx="13" fill="#4F46E5" />
                                            <path
                                                d="M7.66669 12.629L10.4289 15.3913C10.8734 15.8357 11.0956 16.0579 11.3718 16.0579C11.6479 16.0579 11.8701 15.8357 12.3146 15.3913L18.334 9.37183"
                                                stroke="white" stroke-width="1.6" stroke-linecap="round" />
                                        </svg>
                                        <span id="medicine-forme" class="font-normal text-base text-gray-900 "></span>
                                    </li>
                                    <li class="flex items-center gap-3">
                                        <svg width="26" height="26" viewBox="0 0 26 26" fill="none"
                                            xmlns="http://www.w3.org/2000/svg">
                                            <rect width="26" height="26" rx="13" fill="#4F46E5" />
                                            <path
                                                d="M7.66669 12.629L10.4289 15.3913C10.8734 15.8357 11.0956 16.0579 11.3718 16.0579C11.6479 16.0579 11.8701 15.8357 12.3146 15.3913L18.334 9.37183"
                                                stroke="white" stroke-width="1.6" stroke-linecap="round" />
                                        </svg>
                                        <span id="medicine-dosage" class="font-normal text-base text-gray-900"></span>
                                        <span id="medicine-unitDosage" class="font-normal text-base text-gray-900"></span>
                                    </li>
                                </ul>
                                <p class="text-gray-900 text-lg leading-8 font-medium mb-1">Amount</p>
                                <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 mb-4">
                                    <div class="flex sm:items-center sm:justify-center w-full">
                                        <button id="decrement-button"
                                            class="group py-4 px-6 border border-gray-400 rounded-l-full bg-white transition-all duration-300 hover:bg-gray-50 hover:shadow-sm hover:shadow-gray-300">
                                            <svg class="stroke-gray-900 group-hover:stroke-black" width="16" height="16"
                                                viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                <path d="M16.5 11H5.5" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" />
                                            </svg>
                                        </button>
                                        <input id="medicine-quantity" type="text"
                                            class="font-semibold text-gray-900 cursor-pointer text-lg px-6 w-full sm:max-w-[118px] outline-0 border-y border-gray-400 bg-transparent placeholder:text-gray-900 text-center hover:bg-gray-50"
                                            placeholder="1">
                                        <button id="increment-button"
                                            class="group py-4 px-6 border border-gray-400 rounded-r-full bg-white transition-all duration-300 hover:bg-gray-50 hover:shadow-sm hover:shadow-gray-300">
                                            <svg class="stroke-gray-900 group-hover:stroke-black" width="16" height="16"
                                                viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                <path d="M11 5.5V16.5M16.5 11H5.5" stroke="#9CA3AF" stroke-width="1.6"
                                                    stroke-linecap="round" />
                                                <path d="M11 5.5V16.5M16.5 11H5.5" stroke="black" stroke-opacity="0.2"
                                                    stroke-width="1.6" stroke-linecap="round" />
                                                <path d="M11 5.5V16.5M16.5 11H5.5" stroke="black" stroke-opacity="0.2"
                                                    stroke-width="1.6" stroke-linecap="round" />
                                            </svg>
                                        </button>
                                    </div>
                                    <div id="medicine-total"
                                         class="font-manrope font-semibold text-2xl leading-9 text-gray-900 pr-5 mr-1 group py-2 px-2 w-full flex items-center justify-center gap-2">
                                        $0.00</div>
                                </div>
                                <div class="flex flex-wrap items-center gap-6">
                                    <button id="medicineStock_id"
                                            data-medicine-id="1"
                                        class="text-center flex-1 px-3 py-3 rounded-full bg-indigo-500 flex items-center justify-center font-semibold text-lg text-white shadow-sm transition-all duration-600 hover:bg-indigo-600 hover:shadow-indigo-400">
                                        Book Now
                                    </button>
                                    <a id="medicine-idPharmacy" href="/client/client_pharmacy/"
                                        class="text-center flex-1 px-3 py-3 rounded-full bg-indigo-500 flex items-center justify-center font-semibold text-lg text-white shadow-sm transition-all duration-500 hover:bg-indigo-600 hover:shadow-indigo-400">
                                        Pharmacy Page
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <div class="mx-auto max-w-2xl px-4 py-16 sm:px-6 sm:py-24 lg:max-w-7xl lg:px-8 flex flex-col items-center">
                <h2 class="text-2xl font-bold text-gray-900 mb-10">Other Medicines</h2>
                <div id="stock-list" class="grid grid-cols-1 gap-x-6 gap-y-10 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 xl:gap-x-8">
                </div>
                <div class="mt-10 flex justify-center w-full">
                    <button id="more-button" type="button" class="text-white bg-blue-700 hover:bg-blue-800 focus:outline-none focus:ring-4 focus:ring-blue-300 font-medium rounded-full text-sm px-10 py-2.5 text-center me-2 mb-2 dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800">
                        More
                    </button>
                </div>
            </div>

        </div>
     </main>
    <div id="reservation-div" class="hidden absolute w-full h-screen flex items-center justify-center bg-transparent">
        <div class="bg-white overflow-hidden shadow rounded-lg border z-40">
            <div class="px-4 py-5 sm:px-6 flex justify-between items-center">
                <h3 class="text-lg leading-6 font-medium text-gray-900">
                    Your reservation
                </h3>

                <button type="button" class="bg-white rounded-md p-2 inline-flex items-center justify-center text-gray-400 hover:text-gray-500 hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-indigo-500">
                    <span class="sr-only">Close menu</span>
                    <svg class="h-5 w-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
            <div class="border-t border-gray-200 px-4 py-5 sm:p-0">
                <dl class="sm:divide-y sm:divide-gray-200">
                    <div class="py-2 sm:py-3 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
                        <dt class="text-sm font-medium text-gray-500">
                            Medicine name:
                        </dt>
                        <dd class="mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2">
                            Name
                        </dd>
                    </div>
                    <div class="py-2 sm:py-3 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
                        <dt class="text-sm font-medium text-gray-500">
                            Amount:
                        </dt>
                        <dd class="mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2">
                            2
                        </dd>
                    </div>
                    <div class="py-2 sm:py-3 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
                        <dt class="text-sm font-medium text-gray-500">
                            Price:
                        </dt>
                        <dd class="mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2">
                            $100
                        </dd>
                    </div>

                    <form action="/client/add_reservation"  method="post"
                          class="pt-2 pb-3 sm:py-3 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
                        <input type="hidden" name="medicineId">
                        <input type="hidden" name="amount">
                        <input type="hidden" name="price">
                        <dt class="text-sm font-medium text-gray-500">
                            <label for="message" class="w-full h-full">Your message</label>
                        </dt>
                        <dd class="mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2">
                            <textarea id="message" name="message" rows="4" class="block p-2.5 w-full text-sm text-gray-900 bg-gray-50 rounded-lg border border-gray-300 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500" placeholder="Leave a comment..."></textarea>
                        </dd>
                        <button type="submit"
                                class="text-gray-900 bg-white border border-gray-300 focus:outline-none hover:bg-gray-100 focus:ring-4 focus:ring-gray-100 font-medium rounded-lg text-sm px-5 py-2.5 me-2 mb-2 dark:bg-gray-800 dark:text-white dark:border-gray-600 dark:hover:bg-gray-700 dark:hover:border-gray-600 dark:focus:ring-gray-700">
                                Reserve
                        </button>
                    </form>
                </dl>
            </div>
        </div>
    </div>

    <script src="/pharmacy/static/js/script.js"></script>
    <script>

        const medicine = {{ medicine | safe }} || [];
        const stocks = {{ stocks | safe }} || [];
        const reservations = {{ reservations | safe }} || [];

        function toggleDropdown() {
            const dropdown = document.getElementById("navbar_dropdown");
            dropdown.classList.toggle("hidden");
        }

        function toggleReservationDropdown() {
            const dropdown = document.getElementById("navbar_reservation_dropdown");
            dropdown.classList.toggle("hidden");
        }

        class Medicine {
            constructor(id, idPharmacy, name, forme, presentation, composition, dosage, unitDosage, image, price, amount) {
                this.id = id;
                this.name = name;
                this.forme = forme;
                this.presentation = presentation;
                this.composition = composition;
                this.dosage = dosage;
                this.unitDosage = unitDosage;
                this.image = image;
                this.price= price;
                this.amount = amount;
                this.idPharmacy = idPharmacy;
            }


            static displayMedicine(medicine) {
                const idElement = document.getElementById('medicineStock_id');
                if (idElement) {
                    idElement.setAttribute('data-medicine-id',medicine.id);
                }


                const nameElement = document.getElementById('medicine-name');
                nameElement.textContent = medicine.name;

                const priceElement = document.getElementById('medicine-price');
                priceElement.textContent = medicine.price;

                const presentationElement = document.getElementById('medicine-presentation');
                presentationElement.textContent = medicine.presentation;

                const compositionElement = document.getElementById('medicine-composition');
                compositionElement.textContent = medicine.composition;

                const formeElement = document.getElementById('medicine-forme');
                formeElement.textContent = medicine.forme;

                const dosageElement = document.getElementById('medicine-dosage');
                dosageElement.textContent = medicine.dosage;

                const unitDosageElement = document.getElementById('medicine-unitDosage');
                unitDosageElement.textContent = medicine.unitDosage;

                const amountElement = document.getElementById('medicine-amount');
                if (medicine.amount > 0) {
                    amountElement.textContent = `${medicine.amount} Available`;
                } else {
                    amountElement.textContent = "Out of Stock";
                }

                const idPharmacyElement = document.getElementById('medicine-idPharmacy');
                if (idPharmacyElement) {
                    const existingUrl = idPharmacyElement.href;
                    idPharmacyElement.href = `${existingUrl}${medicine.idPharmacy}`;
                }

                const imageElement = document.getElementById('medicine-image');
                imageElement.src = medicine.image;

                this.setupQuantityControls(medicine);

                console.log("Medicine displayed:", medicine);
            }

            static setupQuantityControls(medicine) {
                const decrementButton = document.getElementById('decrement-button');
                const incrementButton = document.getElementById('increment-button');
                const quantityInput = document.getElementById('medicine-quantity');
                const totalPriceElement = document.getElementById('medicine-total');

                // Initialize the total price
                function updateTotalPrice(quantity) {
                    const totalPrice = quantity * medicine.price;
                    totalPriceElement.textContent = `$${totalPrice.toFixed(2)}`;
                }

                // Disable controls if no stock is available
                function disableControls() {
                    decrementButton.disabled = true;
                    incrementButton.disabled = true;
                    quantityInput.disabled = true;
                    totalPriceElement.textContent = "N/A";
                }

                // Increment or decrement quantity
                function handleQuantityChange(action) {
                    let currentQuantity = parseInt(quantityInput.value) || 1;

                    if (action === "increment" && currentQuantity < medicine.amount) {
                        currentQuantity++;
                    } else if (action === "decrement" && currentQuantity > 1) {
                        currentQuantity--;
                    }

                    quantityInput.value = currentQuantity;
                    updateTotalPrice(currentQuantity);
                }

                // Manual input for quantity
                quantityInput.addEventListener("input", () => {
                    let inputQuantity = parseInt(quantityInput.value) || 1;

                    // Ensure the quantity stays within bounds
                    if (inputQuantity > medicine.amount) {
                        inputQuantity = medicine.amount;
                    } else if (inputQuantity < 1) {
                        inputQuantity = 1;
                    }

                    quantityInput.value = inputQuantity;
                    updateTotalPrice(inputQuantity);
                });

                // Event listeners for increment and decrement buttons
                incrementButton.addEventListener("click", () => handleQuantityChange("increment"));
                decrementButton.addEventListener("click", () => handleQuantityChange("decrement"));

                // Initialize controls
                if (medicine.amount === 0) {
                    disableControls();
                } else {
                    updateTotalPrice(1); // Default quantity is 1
                }
            }
        }

         function loadMedicine() {
            if (!medicine || medicine.length === 0) {
                console.error("No medicine data loaded from backend");
                return;
            }
            Medicine.displayMedicine(medicine);
        }

        class Stock {
            constructor(id, name, image, price, quantity) {
                this.id = id;
                this.name = name;
                this.image = image;
                this.price = price;
                this.quantity = quantity;
            }

            static displayStocks(stocks) {
                const container = document.getElementById('stock-list');
                stocks.forEach((stock) => {
                    const stockElement = document.createElement('a');
                    stockElement.href = `/client/client_medicine/${stock.id}`;
                    stockElement.classList.add('group');
                    stockElement.innerHTML = `
                         <img src="${ stock.image }" alt="${ stock.name }" class="aspect-square w-full rounded-lg bg-gray-200 object-cover group-hover:opacity-75 xl:aspect-[7/8]">
                         <h3 class="mt-4 text-sm text-gray-700">${ stock.name }</h3>
                         <p class="mt-1 text-lg font-medium text-gray-900">Price: ${ stock.price }DH, Rest: ${ stock.quantity }</p>
                    `;
                    container.appendChild(stockElement);
                });
                console.log("Stocks displayed:", stocks);
            }

            static loadAndDisplayStocks(stocks, currentIndex, numberToLoad) {
                const remainingStocks = stocks.slice(currentIndex, currentIndex + numberToLoad);
                this.displayStocks(remainingStocks);
                const newIndex = currentIndex + remainingStocks.length;
                if (newIndex >= stocks.length) {
                    const moreButton = document.getElementById('more-button');
                    moreButton.disabled = true;
                    moreButton.innerText = "No more medicines";
                }
                return newIndex;
            }
        }

        let currentIndex = 0;
        const numberToLoad = 8;
        function loadStocks() {

            if (!stocks || stocks.length === 0) {
                console.error("No stocks data loaded from backend");
                return;
            }
             currentIndex = Stock.loadAndDisplayStocks(stocks, currentIndex, numberToLoad);
        }


        function addMedicineToReservation(medicineName, amount, totalPrice, medicineId) {
            const reservationDiv = document.getElementById('reservation-div');
            reservationDiv.classList.remove('hidden');

            const nameElement = reservationDiv.querySelector('dl .text-sm.font-medium.text-gray-500 + dd');
            nameElement.textContent = medicineName;

            const amountElement = reservationDiv.querySelectorAll('dl .text-sm.font-medium.text-gray-500 + dd')[1];
            amountElement.textContent = amount || 1;

            const priceElement = reservationDiv.querySelectorAll('dl .text-sm.font-medium.text-gray-500 + dd')[2];
            priceElement.textContent = `$${totalPrice}`;

            let hiddenIdInput = reservationDiv.querySelector('input[name="medicineId"]');
            if (!hiddenIdInput) {
                hiddenIdInput = document.createElement('input');
                hiddenIdInput.type = 'hidden';
                hiddenIdInput.name = 'medicineId';
                reservationDiv.querySelector('form').appendChild(hiddenIdInput);
            }
            hiddenIdInput.value = medicineId;

            let hiddenAmountInput = reservationDiv.querySelector('input[name="amount"]');
            if (!hiddenAmountInput) {
                hiddenAmountInput = document.createElement('input');
                hiddenAmountInput.type = 'hidden';
                hiddenAmountInput.name = 'amount';
                reservationDiv.querySelector('form').appendChild(hiddenAmountInput);
            }
            hiddenAmountInput.value = amount;

            let hiddenPriceInput = reservationDiv.querySelector('input[name="price"]');
            if (!hiddenPriceInput) {
                hiddenPriceInput = document.createElement('input');
                hiddenPriceInput.type = 'hidden';
                hiddenPriceInput.name = 'price';
                reservationDiv.querySelector('form').appendChild(hiddenPriceInput);
            }
            hiddenPriceInput.value = totalPrice;
        }

        function hideReservationDiv() {
            const reservationDiv = document.getElementById('reservation-div');
            reservationDiv.classList.add('hidden');
        }

        document.getElementById('medicineStock_id').addEventListener('click', () => {
            // Example medicine data
            const medicineName = document.getElementById('medicine-name').textContent;
            const amount = document.getElementById('medicine-quantity').value;
            const totalPrice = document.getElementById('medicine-total').textContent.replace('$', '');
            const medicineId = document.getElementById('medicineStock_id').dataset.medicineId;

            addMedicineToReservation(medicineName, amount, totalPrice, medicineId);
        });

        class Reservation {
            constructor(id, name, amount, price) {
                this.id = id;
                this.name = name;
                this.amount = amount;
                this.price = price;
            }

            static displayReservations(reservations) {
                const container = document.getElementById('reservation-list');
                reservations.forEach((reservation) => {
                    const reservationElement = document.createElement('tr');
                    reservationElement.classList.add('bg-white', 'border-b', 'dark:bg-gray-800', 'dark:border-gray-700', 'hover:bg-gray-50', 'dark:hover:bg-gray-600');
                    reservationElement.innerHTML = `
                                    <th scope="row" class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap dark:text-white">
                                        ${reservation.name}
                                    </th>
                                    <td class="px-6 py-4">
                                        ${reservation.amount}
                                    </td>
                                    <td class="px-6 py-4">
                                        $${reservation.price}
                                    </td>
                                    <td class="px-6 py-4 text-right">
                                        <a href="/client/delete_reservation/${reservation.id}" class="font-medium text-blue-600 dark:text-blue-500 hover:underline">Delete</a>
                                    </td>
                    `;
                    container.appendChild(reservationElement);
                });
                console.log("Reservations displayed:", reservations);
            }
        }

        function loadReservations() {
            if (!reservations || reservations.length === 0) {
                console.error("No reservations data loaded from backend");
                return;
            }
             Reservation.displayReservations(reservations);
        }


        window.onload = function () {
            loadMedicine();
            loadStocks();
            loadReservations();
        };

        document.getElementById('more-button').addEventListener('click', () => {
            loadStocks();
        });
        document.querySelector('#reservation-div button[type="button"]').addEventListener('click', hideReservationDiv);

    </script>
</body>
</html>
